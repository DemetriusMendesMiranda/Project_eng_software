previews:
  generation: automatic
  # Optional: automatically expire preview envs after N days without new commits
  # expireAfterDays: 7

services:
  # Backend (PHP)
  - type: web
    name: backend-php
    plan: starter
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    autoDeploy: true
    healthCheckPath: /
    previews:
      plan: starter
      numInstances: 1
    # Set these in Render Dashboard (Settings > Environment)
    # envVars:
    #   - key: DB_HOST
    #     value: your-mysql-host
    #   - key: DB_PORT
    #     value: 3306
    #   - key: DB_NAME
    #     value: scrum_db
    #   - key: DB_USER
    #     value: your-user
    #   - key: DB_PASS
    #     value: your-password

  # Frontend (Next.js)
  - type: web
    name: frontend-next
    plan: starter
    env: node
    buildCommand: |
      corepack enable
      corepack prepare pnpm@8.15.4 --activate
      pnpm install --frozen-lockfile
      pnpm build
    startCommand: pnpm start
    autoDeploy: true
    healthCheckPath: /
    previews:
      plan: starter
      numInstances: 1
    # After the backend is live, set NEXT_PUBLIC_API_BASE_URL to the backend URL
    # envVars:
    #   - key: NEXT_PUBLIC_API_BASE_URL
    #     value: https://backend-php.onrender.com

